---
// src/pages/index.astro
import { getCollection } from "astro:content";

import ContactCard from "../components/ContactCard.astro";
import TimelineEntry from "../components/TimelineEntry.astro";

import astroLogo from "../assets/rjk.svg";
import Layout from "../layouts/Layout.astro";

// Get all blog posts and sort by date
const posts = await getCollection("blog");
const sortedPosts = posts.sort(
	(a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

// Get the latest post and the rest
const [latestPost, ...previousPosts] = sortedPosts;

const timelineEntries = await getCollection("timeline");
const sortedTimelineEntries = timelineEntries.sort(
	(a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

// Get current position (Tesla)
const currentPosition = sortedTimelineEntries.find(
	(entry) => entry.data.featuredMessage === "Current Position",
);

// Get current year for footer
const currentYear = new Date().getFullYear();
---

<Layout>
  <div class="min-h-screen p-4 md:p-8 flex flex-col">
    <div class="max-w-6xl mx-auto space-y-6 flex-grow w-full">
      <!-- Hero Section - Compact -->
      <div
        class="bg-gradient-to-br from-blue-50/50 to-blue-100/30 dark:from-blue-950/20 dark:to-blue-900/10 rounded-3xl border border-gray-200 dark:border-neutral-900 p-6 md:p-8"
      >
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
          <div class="flex-grow">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-3">
              Hi, I'm Rob
            </h1>
            <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl">
              Electrical and computer engineering student with an entrepreneurial spirit at UT Austin.
            </p>
          </div>
          <div class="flex flex-col sm:flex-row gap-3">
            <a
              href="/writing/about"
              class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full font-medium transition-all hover:scale-105 flex items-center gap-2 justify-center"
            >
              Learn More
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-arrow-right"
              >
                <path d="M5 12h14"></path>
                <path d="m12 5 7 7-7 7"></path>
              </svg>
            </a>
            <a
              href="/contact"
              class="px-6 py-3 bg-white dark:bg-neutral-900 hover:bg-gray-50 dark:hover:bg-neutral-800 text-gray-900 dark:text-white rounded-xl font-medium transition-all border border-gray-200 dark:border-neutral-800 hover:scale-105 flex items-center justify-center"
            >
              Get in Touch
            </a>
          </div>
        </div>
      </div>

      <!-- Main Content Grid - Asymmetric Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column: Combined Writing Section -->
        <div class="lg:col-span-2">
          <div class="bg-white dark:bg-black rounded-3xl p-6 md:p-8 border border-gray-200 dark:border-neutral-900">
            <div class="flex justify-between items-center mb-6">
              <div class="flex items-center gap-3">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-book-open-text text-gray-900 dark:text-white"
                >
                  <path d="M12 7v14"></path>
                  <path d="M16 12h2"></path>
                  <path d="M16 8h2"></path>
                  <path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path>
                  <path d="M6 12h2"></path>
                  <path d="M6 8h2"></path>
                </svg>
                <h3 class="text-2xl font-semibold text-gray-900 dark:text-white">
                  Writing
                </h3>
              </div>
              <a
                href="/writing"
                class="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 group/link"
              >
                View All
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-arrow-right group-hover/link:translate-x-1 transition-transform"
                >
                  <path d="M5 12h14"></path>
                  <path d="m12 5 7 7-7 7"></path>
                </svg>
              </a>
            </div>

            <div class="space-y-4">
              <!-- Featured Latest Post -->
              {latestPost && (
                <a
                  href={`/writing/${latestPost.slug}`}
                  class="block group bg-gray-50 dark:bg-neutral-900 rounded-2xl p-6 md:p-8 border border-gray-200 dark:border-neutral-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all"
                >
                  <div class="flex items-center gap-2 mb-3">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-sparkles text-blue-600"
                    >
                      <path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path>
                    </svg>
                    <span class="text-sm font-semibold text-blue-600 uppercase tracking-wide">
                      Latest Post
                    </span>
                  </div>
                  <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                    {latestPost.data.title}
                  </h2>
                  <p class="text-base text-gray-600 dark:text-gray-400 leading-relaxed mb-4">
                    {latestPost.data.description}
                  </p>
                  <div class="flex items-center gap-3 text-sm text-gray-500">
                    <span>{latestPost.data.formattedDate}</span>
                    <span class="inline-block w-1.5 h-1.5 rounded-full bg-gray-400"></span>
                    <span>{latestPost.data.readingTime} min read</span>
                  </div>
                </a>
              )}

              <!-- Other Posts -->
              {previousPosts.slice(0, 3).map((post) => (
                <a
                  href={`/writing/${post.slug}`}
                  class="block group bg-gray-50 dark:bg-neutral-900 rounded-2xl p-5 border border-gray-200 dark:border-neutral-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all"
                >
                  <h4 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors mb-2">
                    {post.data.title}
                  </h4>
                  <div class="flex items-center gap-2 text-sm text-gray-500">
                    <span>{post.data.formattedDate}</span>
                    <span class="inline-block w-1 h-1 rounded-full bg-gray-400"></span>
                    <span>{post.data.readingTime} min read</span>
                  </div>
                </a>
              ))}
            </div>
          </div>
        </div>

        <!-- Right Column: Current Position + Activities -->
        <div class="space-y-6">
          <!-- Current Position -->
          {currentPosition && (
            <div class="bg-white dark:bg-black rounded-3xl p-6 border border-gray-200 dark:border-neutral-900">
              <div class="flex items-center gap-2 mb-4">
                <div class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide">
                  Currently Working On
                </h3>
              </div>
              <a
                href={`/timeline/${currentPosition.slug}`}
                class="block group"
              >
                <h4 class="text-xl font-semibold text-gray-900 dark:text-white mb-3 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                  {currentPosition.data.title}
                </h4>
                {currentPosition.data.description && (
                  <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    {currentPosition.data.description}
                  </p>
                )}
                <div class="flex flex-wrap gap-2">
                  {currentPosition.data.tags?.map((tag: string) => (
                    <span class="px-3 py-1 bg-blue-50 dark:bg-blue-950/30 text-blue-600 dark:text-blue-400 rounded-full text-xs font-medium">
                      {tag}
                    </span>
                  ))}
                </div>
              </a>
              <a
                href="/timeline"
                class="mt-6 flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 group/more"
              >
                View Full Timeline
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-arrow-right group-hover/more:translate-x-1 transition-transform"
                >
                  <path d="M5 12h14"></path>
                  <path d="m12 5 7 7-7 7"></path>
                </svg>
              </a>
            </div>
          )}

          <!-- Contact Card -->
          <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-neutral-900 dark:to-neutral-800 rounded-3xl p-6 border border-gray-200 dark:border-neutral-800">
            <ContactCard
              email="hi@robertjkirk.com"
              linkedin="robertjkirk"
            />
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>
