---
// src/pages/writing/index.astro
import { getCollection } from "astro:content";
import WritingFilter from "../../components/WritingFilter";
import Layout from "../../layouts/Layout.astro";

// Get all blog posts and sort by date
const posts = await getCollection("blog");
const sortedPosts = posts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);

// Prepare posts data for client component
const postsData = sortedPosts.map(post => ({
  slug: post.slug,
  title: post.data.title,
  description: post.data.description,
  formattedDate: post.data.formattedDate,
  readingTime: post.data.readingTime,
  category: post.data.category,
}));
---

<Layout>
  <div class="min-h-screen p-4 md:p-8 transition-all">
    <div
      class="bg-white dark:bg-black rounded-3xl mx-auto max-w-3xl p-6 md:p-12 shadow-sm border border-gray-200 dark:border-neutral-900"
    >
      <!-- Header with Back Link -->

      <!-- Blog Header -->
      <header class="mb-12 text-gray-900 dark:text-neutral-100">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="36"
          height="36"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-book-open-text"
        >
          <path d="M12 7v14"></path>
          <path d="M16 12h2"></path>
          <path d="M16 8h2"></path>
          <path
            d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"
          ></path>
          <path d="M6 12h2"></path>
          <path d="M6 8h2"></path>
        </svg>
        <h1 class="text-4xl font-bold mt-2">Writing</h1>
        <p class="text-lg text-gray-600 dark:text-neutral-500 mt-2">
          Thoughts on design and development
        </p>
      </header>

      <!-- Filter Buttons -->
      <div class="flex gap-2 mb-6 flex-wrap" id="filter-buttons">
        <button data-filter="All" class="filter-btn active px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-blue-600 text-white">All</button>
        <button data-filter="Interactive" class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-gray-100 dark:bg-neutral-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-neutral-700">Interactive</button>
        <button data-filter="Philosophy" class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-gray-100 dark:bg-neutral-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-neutral-700">Philosophy</button>
        <button data-filter="Projects" class="filter-btn px-4 py-1.5 rounded-full text-sm font-medium transition-all bg-gray-100 dark:bg-neutral-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-neutral-700">Projects</button>
      </div>

      <!-- Blog Posts Grid -->
      <div class="space-y-4" id="posts-container">
        {sortedPosts.map((post, index) => (
          <a
            href={`/writing/${post.slug}`}
            data-category={post.data.category || ""}
            class="post-item block group bg-gray-50 dark:bg-neutral-900/70 rounded-2xl p-6 border border-gray-200 dark:border-neutral-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all"
          >
            {index === 0 && (
              <div class="flex items-center gap-2 mb-2">
                <span class="text-sm font-medium text-blue-600">New</span>
                <span class="inline-block w-1.5 h-1.5 rounded-full bg-blue-600 animate-pulse" />
              </div>
            )}
            <h3 
              class="font-medium text-lg dark:text-neutral-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors"
              transition:name={`title-${post.slug}`}
            >
              {post.data.title}
            </h3>
            <p class="text-gray-600 dark:text-neutral-500 my-2">
              {post.data.description}
            </p>
            <div class="flex items-center gap-2 mt-4">
              <span class="text-sm text-gray-500 dark:text-neutral-600">{post.data.formattedDate}</span>
              <span class="inline-block w-1 h-1 rounded-full bg-gray-500" />
              <span class="text-sm text-gray-500 dark:text-neutral-600">{post.data.readingTime} min read</span>
            </div>
          </a>
        ))}
      </div>

      <script>
        document.addEventListener('astro:page-load', () => {
          const buttons = document.querySelectorAll('.filter-btn');
          const posts = document.querySelectorAll('.post-item');
          
          buttons.forEach(btn => {
            btn.addEventListener('click', () => {
              const filter = btn.getAttribute('data-filter');
              
              // Update button styles
              buttons.forEach(b => {
                b.classList.remove('bg-blue-600', 'text-white');
                b.classList.add('bg-gray-100', 'dark:bg-neutral-800', 'text-gray-600', 'dark:text-gray-400');
              });
              btn.classList.remove('bg-gray-100', 'dark:bg-neutral-800', 'text-gray-600', 'dark:text-gray-400');
              btn.classList.add('bg-blue-600', 'text-white');
              
              // Filter posts
              posts.forEach(post => {
                const category = post.getAttribute('data-category');
                if (filter === 'All' || category === filter) {
                  post.style.display = 'block';
                } else {
                  post.style.display = 'none';
                }
              });
            });
          });
        });
      </script>
    </div>
  </div>
</Layout>
